name: test-and-publish

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [12.x]
    steps:
    - uses: actions/checkout@v1
    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v1
      with:
        node-version: ${{ matrix.node-version }}
    - name: Setup MongoDB
      run: sudo apt-get install -y mongodb
    - name: Test without encryption
      run: bash test.sh
      env:
        DEBUG_ERRORS: "true"
        DEBUG_REQUESTS: "true"
        DEBUG_PUPPETEER: "true"
    - name: Test with encryption
      run: bash test.sh
      env:
        ENCRYPTION_SECRET: "12345678901234567890123456789012"
        ENCRYPTION_SECRET_IV: "1234123412341234"
    - name: Publish to NPM
      uses: JS-DevTools/npm-publish@v1
      with:
        token: ${{ secrets.NPM_TOKEN }}
        